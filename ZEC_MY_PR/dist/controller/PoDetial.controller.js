sap.ui.define(["ZEC_MY_REQUIREMENTS/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/GroupHeaderListItem","sap/ui/core/Priority","sap/m/MessageToast","sap/ui/core/routing/History","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,s,r,a,n,l,o){"use strict";var u=new t;var i=new t;return e.extend("ZEC_MY_REQUIREMENTS.controller.PoDetial",{onInit:function(){this.getRouter().getRoute("PoDetial").attachPatternMatched(this._onRequestMatched,this);this.getView().setModel(u,"ZPoList");this.getView().setModel(i,"PoDetial")},_onRequestMatched:function(e){var t=e.getParameters()["arguments"].ObjectId;var s=[];s.push(new l("ObjectId",o.EQ,t));var r=this.getOwnerComponent().getModel();r.setUseBatch(false);var a=[];var n=this;r.read("/Zpo_listSet",{filters:s,success:function(e,t){for(var s=0;s<e.results.length;s++){var r={ObjectId:e.results[s].ObjectId,Ebeln:e.results[s].Ebeln,Bukrs:e.results[s].Bukrs,Ekorg:e.results[s].Ekorg,Ekgrp:e.results[s].Ekgrp,Wgbez:e.results[s].Wgbez,Lifnr:e.results[s].Lifnr,LifnrNam:e.results[s].LifnrNam,PoStat:e.results[s].PoStat,PoStatTxt:e.results[s].PoStatTxt,Value:e.results[s].Value,Waers:e.results[s].Waers,Eindt:e.results[s].Eindt,MengeSh:e.results[s].MengeSh,MsgTxt:e.results[s].MsgTxt};a.push(r);var l=n.getGlobalVar("Stat");if(e.results[s].Ebeln.indexOf("#TMP")!==-1&&l!=="30"){n.byId("OnRegeneratePo").setEnabled(true)}}u.setData(a)},error:function(e){}})},onGeneratePo:function(e){var t=this.getView().getModel("ZPoList").getData();var s=this.byId("PolistTable").getSelectedIndex();if(s<0){a.show("请至少选择一行进行采购订单生成");return}var r=this.getOwnerComponent().getModel();var n=this;r.setUseBatch(false);r.callFunction("/onGeneratePo",{method:"POST",urlParameters:{Ebeln:t[s].Ebeln,ObjectId:t[s].ObjectId},success:function(r,l){for(var o=0;o<t.length;o++){if(o===s){t[s].Ebeln=r.Ebeln}}u.setData(t);n.onSelectionChange(e);n.getModel().refresh();a.show("采购订单重新生成成功!")},error:function(e){var t=JSON.parse(e.responseText);var s=t.error.message.value;a.show("失败,消息:"&&s)}})},onSelectionChange:function(e){var t=this.getView().getModel("ZPoList").getData();var s=this.byId("PolistTable").getSelectedIndex();var r=[];var a=t[s].Ebeln;if(a.length>0){r.push(new l("Ebeln",o.EQ,a));r.push(new l("ObjectId",o.EQ,t[s].ObjectId))}var n=this.getOwnerComponent().getModel();var u=[];var g=this;n.setUseBatch(false);n.read("/Zpo_detialSet",{filters:r,success:function(e,t){for(var s=0;s<e.results.length;s++){var r={Ebelp:e.results[s].Ebelp,Loekz:e.results[s].Loekz,Knttp:e.results[s].Knttp,Werks:e.results[s].Werks,Matnr:e.results[s].Matnr,Maktx:e.results[s].Maktx,Matkl:e.results[s].Matkl,Wgbez:e.results[s].Wgbez,MengeDd:e.results[s].MengeDd,MengeSh:e.results[s].MengeSh,Meins:e.results[s].Meins,Netpr:e.results[s].Netpr,Peinh:e.results[s].Peinh,Value:e.results[s].Value.toString(),Waers:e.results[s].Waers,Eindt:e.results[s].Eindt,Lgort:e.results[s].Lgort,PoStat:e.results[s].PoStat,PoStatTxt:e.results[s].PoStatTxt};u.push(r)}i.setData(u)},error:function(e){}})}})});
//# sourceMappingURL=PoDetial.controller.js.map